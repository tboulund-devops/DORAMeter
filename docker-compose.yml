services: 
  api:
    profiles:
      - application
    image: ghcr.io/tboulund-devops/dora-meter-api
    ports:
      - "8080:8080"
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
  
  sonarqube:
    profiles:
      - utils
    image: sonarqube
    ports:
      - "9000:9000"
    environment:
      - SONAR_JDBC_URL=jdbc:postgresql://sonar-db:5432/sonarqube
      - SONAR_JDBC_USERNAME=sonar
      - SONAR_JDBC_PASSWORD=sonar
    depends_on:
      - sonar-db
  
  sonar-db:
    profiles:
      - utils
    image: postgres:latest
    environment:
      - POSTGRES_USER=sonar
      - POSTGRES_PASSWORD=sonar
      - POSTGRES_DB=sonarqube
    volumes:
      - sonar-db-data:/var/lib/postgresql/data
  
  watchtower:
    profiles:
      - utils
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ~/.docker/config.json:/config.json # Share the Docker config file with WatchTower for authentication
    command: --debug --http-api-update
    ports:
      - "8888:8080"
    environment:
      - WATCHTOWER_LABEL_ENABLE=true
      - WATCHTOWER_HTTP_API_TOKEN=TEMPTOKEN # TODO: Skift denne
  
  maria-db:
    profiles:
      - application
      - storage
    image: mariadb
    environment:
      MYSQL_ROOT_PASSWORD: lbw|Z_9?15=48>Z8
      MYSQL_DATABASE: dora_meter
      MYSQL_USER: dbadmin
      MYSQL_PASSWORD: TogetherCenterExceptThusFew
    ports:
      - "3306:3306"
    volumes:
      - db-data:/var/lib/mysql
    
volumes: 
  db-data:
  sonar-db-data: